{% extends '@PrestaShop/Admin/layout.html.twig' %}

{% block content %}
  <div class="row">
    <div class="col-12">
      {% embed '@PrestaShop/Admin/Common/Grid/grid_panel.html.twig' with { grid: typeShipmentGrid } %}
        {% block grid_panel_header %}
          <div class="card-header js-grid-header d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
              <h3 class="card-header-title mb-0">{{ 'Tipos de envío'|trans({}, 'Modules.RjMulticarrier.Admin') }}</h3>
              <span class="badge badge-secondary ml-2">{{ grid.data.records_total }}</span>
            </div>
            <div class="d-flex align-items-center">
              <a
                href="{{ path('admin_rj_multicarrier_type_shipment_create') }}"
                class="btn btn-outline-primary btn-sm mr-2"
              >
                {{ 'Nuevo tipo de envío'|trans({}, 'Modules.RjMulticarrier.Admin') }}
              </a>
              {{ include('@PrestaShop/Admin/Common/Grid/Blocks/grid_actions.html.twig', { grid: grid }) }}
            </div>
          </div>
        {% endblock %}

        {% block grid_panel_body %}
          <div class="card-body">
            {% if companies|length > 1 %}
              <form method="get" action="{{ path('admin_rj_multicarrier_type_shipment_index') }}" class="form-inline mb-3">
                <div class="form-group mr-2">
                  <label for="type_shipment_company_filter" class="mr-2">{{ 'Compañía'|trans({}, 'Modules.RjMulticarrier.Admin') }}</label>
                  <select id="type_shipment_company_filter" name="company" class="form-control" onchange="RoanjaTypeShipment.changeCompany(this)">
                    {% for company in companies %}
                      <option value="{{ company.id }}" {% if company.selected %}selected{% endif %}>{{ company.name }}</option>
                    {% endfor %}
                  </select>
                </div>
              </form>
            {% endif %}

            {{ include('@PrestaShop/Admin/Common/Grid/grid.html.twig', { grid: grid }) }}
          </div>
        {% endblock %}
      {% endembed %}
    </div>
  </div>

  <div
    class="modal fade js-detail-modal"
    id="rj_type_shipment_detail_modal"
    tabindex="-1"
    role="dialog"
    aria-hidden="true"
    data-empty="{{ 'No disponible'|trans({}, 'Modules.RjMulticarrier.Admin') }}"
    data-error-generic="{{ 'No se pudo cargar el detalle del tipo de envío.'|trans({}, 'Modules.RjMulticarrier.Admin') }}"
    data-error-not-found="{{ 'El tipo de envío solicitado ya no existe.'|trans({}, 'Modules.RjMulticarrier.Admin') }}"
    data-trigger=".js-type-shipment-view-row-action"
  >
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title mb-0">{{ 'Detalle del tipo de envío'|trans({}, 'Modules.RjMulticarrier.Admin') }}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="{{ 'Cerrar'|trans({}, 'Admin.Actions') }}">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="alert alert-danger d-none js-detail-error" role="alert"></div>

          <div class="text-center my-4 d-none js-detail-spinner">
            <span class="spinner-border" role="status" aria-hidden="true"></span>
            <span class="sr-only">{{ 'Cargando…'|trans({}, 'Admin.Actions') }}</span>
          </div>

          <div class="js-detail-content d-none">
            <dl class="row">
              <dt class="col-sm-4">{{ 'ID'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
              <dd class="col-sm-8 js-detail-field" data-detail-field="id">—</dd>

              <dt class="col-sm-4">{{ 'Compañía'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
              <dd class="col-sm-8 js-detail-field" data-detail-field="companyName">—</dd>

              <dt class="col-sm-4">{{ 'Nombre corto'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
              <dd class="col-sm-8 js-detail-field" data-detail-field="companyShortName">—</dd>

              <dt class="col-sm-4">{{ 'Nombre'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
              <dd class="col-sm-8 js-detail-field" data-detail-field="name">—</dd>

              <dt class="col-sm-4">{{ 'Código comercial'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
              <dd class="col-sm-8 js-detail-field" data-detail-field="businessCode">—</dd>

              <dt class="col-sm-4">{{ 'Carrier referencia'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
              <dd class="col-sm-8 js-detail-field" data-detail-field="referenceCarrierId">—</dd>

              <dt class="col-sm-4">{{ 'Activo'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
              <dd
                class="col-sm-8 js-detail-field"
                data-detail-field="active"
                data-detail-render="boolean"
                data-detail-true="{{ 'Sí'|trans({}, 'Admin.Global') }}"
                data-detail-false="{{ 'No'|trans({}, 'Admin.Global') }}"
              >—</dd>

              <dt class="col-sm-4">{{ 'Creado el'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
              <dd class="col-sm-8 js-detail-field" data-detail-field="createdAt">—</dd>

              <dt class="col-sm-4">{{ 'Actualizado el'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
              <dd class="col-sm-8 js-detail-field" data-detail-field="updatedAt">—</dd>
            </dl>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">{{ 'Cerrar'|trans({}, 'Admin.Actions') }}</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    window.RoanjaTypeShipment = window.RoanjaTypeShipment || {};
    (function (ns) {
      ns.changeCompany = function (select) {
        try {
          var company = encodeURIComponent(select.value || '');
          var url = new URL(window.location.href);
          url.searchParams.set('company', company);
          // Keep any existing token query parameter if present
          window.location.href = url.toString();
        } catch (e) {
          // Fallback: submit the nearest form
          var form = select && select.form;
          if (form) {
            form.submit();
          }
        }
      };
    })(window.RoanjaTypeShipment);
  </script>
{% endblock %}
