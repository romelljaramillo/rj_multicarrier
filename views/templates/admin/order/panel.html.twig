<div class="card">
	<h3 class="card-header">{{ 'RJ Multi-carrier'|trans({}, 'Modules.RjMulticarrier.Admin') }}</h3>
	<div class="card-body">
		{# If there's a shipment we show details; otherwise show a form to create/save an info package #}
		{% if shipment is defined and shipment %}
			<dl class="row">
				<dt class="col-sm-4">{{ 'Número de envío'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
				<dd class="col-sm-8">{{ shipment.shipmentNumber ?: '-' }}</dd>

				<dt class="col-sm-4">{{ 'Transportista'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
				<dd class="col-sm-8">{{ shipment.carrierShortName ?: '-' }}</dd>

				<dt class="col-sm-4">{{ 'Referencia pedido'|trans({}, 'Modules.RjMulticarrier.Admin') }}</dt>
				<dd class="col-sm-8">{{ shipment.orderReference ?: '-' }}</dd>
			</dl>

			{% if shipment.package is defined and shipment.package %}
				<h4 class="h6 mt-3">{{ 'Información bulto'|trans({}, 'Modules.RjMulticarrier.Admin') }}</h4>
				<ul class="list-unstyled mb-3">
					<li>
						<strong>{{ 'Cantidad'|trans({}, 'Modules.RjMulticarrier.Admin') }}:</strong>
						{{ shipment.package.quantity }}</li>
					<li>
						<strong>{{ 'Peso total'|trans({}, 'Modules.RjMulticarrier.Admin') }}:</strong>
						{{ shipment.package.weight }}</li>
					{% if shipment.package.dimensions %}
						<li>
							<strong>{{ 'Dimensiones'|trans({}, 'Modules.RjMulticarrier.Admin') }}:</strong>
							{{ shipment.package.dimensions.length ?: '-' }}
							x
							{{ shipment.package.dimensions.width ?: '-' }}
							x
							{{ shipment.package.dimensions.height ?: '-' }}
						</li>
					{% endif %}
					{% if shipment.package.cash_on_delivery is defined and shipment.package.cash_on_delivery %}
						<li>
							<strong>{{ 'Contra reembolso'|trans({}, 'Modules.RjMulticarrier.Admin') }}:</strong>
							{{ shipment.package.cash_on_delivery }}</li>
					{% endif %}
					{% if shipment.package.message %}
						<li>
							<strong>{{ 'Mensaje'|trans({}, 'Modules.RjMulticarrier.Admin') }}:</strong>
							{{ shipment.package.message }}</li>
					{% endif %}
					{% if shipment.package.hour_from or shipment.package.hour_until %}
						<li>
							<strong>{{ 'Horario'|trans({}, 'Modules.RjMulticarrier.Admin') }}:</strong>
							{{ shipment.package.hour_from ?: '--:--:--' }}
							→
							{{ shipment.package.hour_until ?: '--:--:--' }}
						</li>
					{% endif %}
					{% if shipment.package.retorno is not null %}
						{% set retornoLabels = {
	              0: 'Sin retorno'|trans({}, 'Modules.RjMulticarrier.Admin'),
	              1: 'Retorno obligatorio'|trans({}, 'Modules.RjMulticarrier.Admin'),
	              2: 'Retorno opcional'|trans({}, 'Modules.RjMulticarrier.Admin')
	            } %}
						<li>
							<strong>{{ 'Retorno'|trans({}, 'Modules.RjMulticarrier.Admin') }}:</strong>
							{{ retornoLabels[shipment.package.retorno]|default(shipment.package.retorno) }}</li>
					{% endif %}
					{% if shipment.package.rcs is not null %}
						<li>
							<strong>{{ 'Retorno copia sellada'|trans({}, 'Modules.RjMulticarrier.Admin') }}:</strong>
							{{ shipment.package.rcs ? 'Sí'|trans({}, 'Modules.RjMulticarrier.Admin') : 'No'|trans({}, 'Modules.RjMulticarrier.Admin') }}</li>
					{% endif %}
					{% if shipment.package.vsec %}
						<li>
							<strong>{{ 'Valor asegurado'|trans({}, 'Modules.RjMulticarrier.Admin') }}:</strong>
							{{ shipment.package.vsec }}</li>
					{% endif %}
					{% if shipment.package.dorig %}
						<li>
							<strong>{{ 'Documento de origen'|trans({}, 'Modules.RjMulticarrier.Admin') }}:</strong>
							{{ shipment.package.dorig }}</li>
					{% endif %}
				</ul>
			{% endif %}

			<h4 class="h6">{{ 'Etiquetas'|trans({}, 'Modules.RjMulticarrier.Admin') }}</h4>
			{% if shipment.labels is not empty %}
				<table class="table table-sm">
					<thead>
						<tr>
							<th>{{ 'ID'|trans({}, 'Modules.RjMulticarrier.Admin') }}</th>
							<th>{{ 'Paquete'|trans({}, 'Modules.RjMulticarrier.Admin') }}</th>
							<th>{{ 'Seguimiento'|trans({}, 'Modules.RjMulticarrier.Admin') }}</th>
							<th>{{ 'Tipo'|trans({}, 'Modules.RjMulticarrier.Admin') }}</th>
							<th>{{ 'Impreso'|trans({}, 'Modules.RjMulticarrier.Admin') }}</th>
						</tr>
					</thead>
					<tbody>
						{% for label in shipment.labels %}
							<tr>
								<td>{{ label.id }}</td>
								<td>{{ label.package_id ?: '-' }}</td>
								<td>{{ label.tracker_code ?: '-' }}</td>
								<td>{{ label.label_type ?: '-' }}</td>
								<td>
									{% if label.printed %}
										<span class="badge bg-success">{{ 'Sí'|trans({}, 'Modules.RjMulticarrier.Admin') }}</span>
									{% else %}
										<span class="badge bg-secondary">{{ 'No'|trans({}, 'Modules.RjMulticarrier.Admin') }}</span>
									{% endif %}
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			{% else %}
				<p class="text-muted">{{ 'No se han generado etiquetas para este envío.'|trans({}, 'Modules.RjMulticarrier.Admin') }}</p>
			{% endif %}
		{% else %}
			{# Show modern form to create/save an info package when no shipment exists #}
			<form method="post" class="rj-multicarrier-admin-order mb-3">
				<input type="hidden" name="id_order" value="{{ id_order|default(orderId)|default(0) }}" />
				<input type="hidden" name="id_infopackage" value="{{ info_package.id_infopackage|default('') }}" />

				<div class="row mb-3">
					<div class="col-md-6">
						<label class="form-label">{{ 'Compañía'|trans({}, 'Modules.RjMulticarrier.Admin') }}</label>
						<select name="company_id" class="form-select">
							<option value="">{{ 'Selecciona compañía'|trans({}, 'Modules.RjMulticarrier.Admin') }}</option>
							{% for company in companies %}
								<option value="{{ company.id|default(company.getId()|default('')) }}">{{ company.name|default(company.getName()|default('')) }}</option>
							{% endfor %}
						</select>
					</div>

					<div class="col-md-6">
						<label class="form-label">{{ 'Tipo de envío'|trans({}, 'Modules.RjMulticarrier.Admin') }}</label>
						<select name="id_type_shipment" class="form-select">
							<option value="">{{ 'Selecciona tipo'|trans({}, 'Modules.RjMulticarrier.Admin') }}</option>
							{% for type in type_shipments %}
								<option value="{{ type.id|default(type.getId()|default('')) }}">{{ type.name|default(type.getName()|default('')) }}</option>
							{% endfor %}
						</select>
					</div>
				</div>

				<div class="row mb-3">
					<div class="col-md-3">
						<label class="form-label">{{ 'Cantidad'|trans({}, 'Modules.RjMulticarrier.Admin') }}</label>
						<input type="number" name="rj_quantity" value="{{ info_package.quantity|default(1) }}" class="form-control"/>
					</div>
					<div class="col-md-3">
						<label class="form-label">{{ 'Peso'|trans({}, 'Modules.RjMulticarrier.Admin') }}</label>
						<input type="text" name="rj_weight" value="{{ info_package.weight|default(0) }}" class="form-control"/>
					</div>
					<div class="col-md-2">
						<label class="form-label">{{ 'Largo'|trans({}, 'Modules.RjMulticarrier.Admin') }}</label>
						<input type="text" name="rj_length" value="{{ info_package.length|default(0) }}" class="form-control"/>
					</div>
					<div class="col-md-2">
						<label class="form-label">{{ 'Ancho'|trans({}, 'Modules.RjMulticarrier.Admin') }}</label>
						<input type="text" name="rj_width" value="{{ info_package.width|default(0) }}" class="form-control"/>
					</div>
					<div class="col-md-2">
						<label class="form-label">{{ 'Alto'|trans({}, 'Modules.RjMulticarrier.Admin') }}</label>
						<input type="text" name="rj_height" value="{{ info_package.height|default(0) }}" class="form-control"/>
					</div>
				</div>

				<div class="mb-3">
					<label class="form-label">{{ 'Mensaje'|trans({}, 'Modules.RjMulticarrier.Admin') }}</label>
					<textarea name="rj_message" class="form-control">{{ info_package.message|default('') }}</textarea>
				</div>

				{% if config_extra_info.company is not empty or config_extra_info.type_shipment is not empty %}
					<div class="mb-3">
						<h5 class="h6">{{ 'Configuraciones guardadas'|trans({}, 'Modules.RjMulticarrier.Admin') }}</h5>
						{% if config_extra_info.company is not empty %}
							<p class="text-muted mb-1">{{ 'Compañía'|trans({}, 'Modules.RjMulticarrier.Admin') }}</p>
							<ul class="list-unstyled small mb-2">
								{% for key, value in config_extra_info.company %}
									<li><strong>{{ key }}</strong>: {{ value is not empty ? value : '-' }}</li>
								{% endfor %}
							</ul>
						{% endif %}

						{% if config_extra_info.type_shipment is not empty %}
							<p class="text-muted mb-1">{{ 'Tipo de envío'|trans({}, 'Modules.RjMulticarrier.Admin') }}</p>
							<ul class="list-unstyled small mb-0">
								{% for key, value in config_extra_info.type_shipment %}
									<li><strong>{{ key }}</strong>: {{ value is not empty ? value : '-' }}</li>
								{% endfor %}
							</ul>
						{% endif %}
					</div>
				{% endif %}

				<div class="d-flex gap-2">
					<button type="submit" name="submitShipment" class="btn btn-primary">{{ 'Generar envío'|trans({}, 'Modules.RjMulticarrier.Admin') }}</button>
					<button type="submit" name="submitSavePackSend" class="btn btn-secondary">{{ 'Guardar bulto'|trans({}, 'Modules.RjMulticarrier.Admin') }}</button>
				</div>
			</form>
		{% endif %}
		{% endif %}
	</div>
</div>
